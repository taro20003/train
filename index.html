<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>トレーニング記録（スマホ版）</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: "Helvetica Neue", "Yu Gothic", "YuGothic", "Hiragino Sans", sans-serif;
      background: #eaf4fc;
      color: #333;
      min-height: 100vh;
    }

    /* ========== ヘッダー ========== */
    .hero {
      text-align: center;
      padding: 48px 20px 40px;
      background: linear-gradient(135deg, #4a90d9 0%, #5fb8f5 50%, #87ceeb 100%);
      position: relative;
      overflow: hidden;
    }
    .hero::before, .hero::after {
      content: ""; position: absolute; border-radius: 50%; background: rgba(255,255,255,0.1);
    }
    .hero::before { width: 300px; height: 300px; top: -80px; left: -60px; }
    .hero::after  { width: 200px; height: 200px; bottom: -50px; right: -30px; }
    .hero h1 {
      font-size: 36px; color: #fff; text-shadow: 0 2px 8px rgba(0,0,0,0.15);
      position: relative; z-index: 1; margin-bottom: 6px;
    }
    .hero .tagline {
      font-size: 16px; color: rgba(255,255,255,0.9); position: relative; z-index: 1;
    }
    .back-link {
      position: absolute; top: 16px; left: 20px; color: rgba(255,255,255,0.85);
      text-decoration: none; font-size: 14px; z-index: 2;
      background: rgba(255,255,255,0.2); padding: 6px 14px; border-radius: 20px;
      transition: background 0.2s;
    }
    .back-link:hover { background: rgba(255,255,255,0.35); }

    /* ========== 共通 ========== */
    .section {
      max-width: 860px; margin: 0 auto; padding: 40px 20px;
    }
    .section-title {
      font-size: 24px; margin-bottom: 24px; text-align: center; color: #2a6cb6;
    }
    .section-title span {
      display: block; font-size: 13px; color: #999; font-weight: normal;
      margin-top: 4px; letter-spacing: 2px; text-transform: uppercase;
    }

    /* ========== 筋トレ入力カード ========== */
    .workout-date-row {
      display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 24px;
    }
    .workout-date-row label { font-size: 15px; font-weight: bold; color: #2a6cb6; }
    .workout-date-row input[type="date"] {
      padding: 10px 14px; border: 2px solid #d6ecfa; border-radius: 12px;
      font-size: 16px; font-family: inherit; outline: none; background: #fff;
      transition: border-color 0.2s;
      -webkit-tap-highlight-color: transparent;
    }
    .workout-date-row input:focus { border-color: #5fb8f5; }

    .exercise-cards { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 20px; }

    .exercise-card {
      background: #fff; border-radius: 20px; padding: 20px 16px; text-align: center;
      box-shadow: 0 4px 16px rgba(0,0,0,0.06); border: 2px solid transparent;
      transition: border-color 0.2s, transform 0.2s;
    }
    .exercise-card:hover { border-color: #5fb8f5; transform: translateY(-2px); }

    .exercise-card .card-illust { margin: 0 auto 6px; }
    .exercise-card .card-illust svg { display: block; margin: 0 auto; }

    .exercise-card .card-name { font-size: 16px; font-weight: bold; color: #2a6cb6; margin-bottom: 2px; }
    .exercise-card .card-desc { font-size: 12px; color: #999; margin-bottom: 12px; }

    .exercise-card .reps-input-row { display: flex; align-items: center; justify-content: center; gap: 8px; }
    .exercise-card .reps-input-row input {
      width: 80px; padding: 10px 8px; border: 2px solid #d6ecfa; border-radius: 12px;
      font-size: 18px; font-family: inherit; text-align: center; outline: none;
      background: #fff; transition: border-color 0.2s;
      -webkit-tap-highlight-color: transparent;
    }
    .exercise-card .reps-input-row input:focus { border-color: #5fb8f5; }
    .exercise-card .reps-input-row .unit { font-size: 14px; color: #888; font-weight: bold; }

    .save-btn {
      display: block; width: 100%; max-width: 400px; margin: 0 auto; padding: 16px;
      background: linear-gradient(135deg, #4a90d9, #5fb8f5); color: #fff; border: none;
      border-radius: 14px; font-size: 18px; font-weight: bold; cursor: pointer;
      transition: opacity 0.2s, transform 0.1s; box-shadow: 0 4px 16px rgba(74,144,217,0.3);
      -webkit-tap-highlight-color: transparent;
      min-height: 50px;
    }
    .save-btn:hover { opacity: 0.9; }
    .save-btn:active { transform: scale(0.98); }

    /* ========== 統計カード ========== */
    .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px; }

    .stat-card {
      background: #fff; border-radius: 16px; padding: 18px 14px; text-align: center;
      box-shadow: 0 4px 16px rgba(0,0,0,0.06);
    }
    .stat-card .stat-name { font-size: 14px; font-weight: bold; color: #2a6cb6; margin-bottom: 10px; }
    .stat-card .stat-row { display: flex; justify-content: space-around; gap: 4px; }
    .stat-card .stat-item { display: flex; flex-direction: column; align-items: center; }
    .stat-card .stat-value { font-size: 20px; font-weight: bold; color: #333; }
    .stat-card .stat-label { font-size: 11px; color: #aaa; margin-top: 2px; }

    /* ========== 月ナビ ========== */
    .month-nav {
      display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 20px;
    }
    .month-nav button {
      background: #fff; border: 2px solid #d6ecfa; color: #2a6cb6; border-radius: 50%;
      width: 44px; height: 44px; font-size: 18px; cursor: pointer; font-weight: bold;
      display: flex; align-items: center; justify-content: center; transition: all 0.2s;
      -webkit-tap-highlight-color: transparent;
    }
    .month-nav button:hover { background: #e0f0ff; border-color: #5fb8f5; }
    .month-nav .month-label { font-size: 18px; font-weight: bold; color: #2a6cb6; min-width: 140px; text-align: center; }

    .month-summary {
      display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;
      margin-bottom: 16px; font-size: 14px; color: #666;
    }
    .month-summary strong { color: #2a6cb6; }

    /* ========== 月別テーブル ========== */
    .month-table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; margin-bottom: 8px; }

    .month-table {
      width: 100%; border-collapse: collapse; font-size: 14px; min-width: 500px;
    }
    .month-table th {
      background: #4a90d9; color: #fff; padding: 10px 8px; font-size: 12px;
      text-align: center; position: sticky; top: 0;
    }
    .month-table td {
      padding: 8px 6px; text-align: center; border-bottom: 1px solid #eef5fc;
    }
    .month-table tr.has-record { background: #f6faff; }
    .month-table tr.has-record:hover { background: #eaf2fd; }
    .month-table tr.no-record td { color: #ccc; }
    .month-table tr.today-row { background: #e3f0ff; font-weight: bold; }
    .month-table tr.future-row td { color: #ddd; }

    .month-table .day-col { font-weight: bold; color: #2a6cb6; white-space: nowrap; }
    .month-table .sun { color: #e55; }
    .month-table .sat { color: #4a90d9; }

    .month-table .val-cell { font-variant-numeric: tabular-nums; }
    .month-table .val-cell.has-val { color: #333; font-weight: bold; }

    .month-table .delete-cell button {
      background: none; border: 1px solid #ffb3b3; color: #e55; border-radius: 6px;
      padding: 6px 12px; font-size: 12px; cursor: pointer; transition: all 0.2s;
      -webkit-tap-highlight-color: transparent;
      min-height: 32px;
    }
    .month-table .delete-cell button:hover { background: #ffe5e5; }

    .month-table tfoot td {
      background: #f0f7fe; font-weight: bold; color: #2a6cb6;
      border-top: 2px solid #d6ecfa; padding: 10px 6px;
    }

    /* ========== ランニング ========== */
    .running-section { background: linear-gradient(135deg, #e8f5e9, #f1f8e9); padding: 40px 20px; }
    .running-inner { max-width: 860px; margin: 0 auto; }
    .running-section .section-title { color: #388e3c; }

    .running-form-card {
      background: #fff; border-radius: 20px; padding: 28px 24px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.06); border: 2px solid rgba(56,142,60,0.15);
      margin-bottom: 24px;
    }
    .running-form-row { display: flex; gap: 12px; align-items: flex-end; flex-wrap: wrap; }
    .running-form-group { display: flex; flex-direction: column; gap: 6px; flex: 1; min-width: 110px; }
    .running-form-group label { font-size: 13px; font-weight: bold; color: #388e3c; }
    .running-form-group input {
      padding: 10px 14px; border: 2px solid #c8e6c9; border-radius: 12px;
      font-size: 16px; font-family: inherit; outline: none; background: #fff;
      transition: border-color 0.2s;
      -webkit-tap-highlight-color: transparent;
    }
    .running-form-group input:focus { border-color: #66bb6a; }

    .running-save-btn {
      padding: 14px 28px; background: linear-gradient(135deg, #43a047, #66bb6a);
      color: #fff; border: none; border-radius: 14px; font-size: 16px; font-weight: bold;
      cursor: pointer; box-shadow: 0 4px 16px rgba(67,160,71,0.3);
      white-space: nowrap; flex-shrink: 0; transition: opacity 0.2s, transform 0.1s;
      -webkit-tap-highlight-color: transparent;
      min-height: 48px;
    }
    .running-save-btn:hover { opacity: 0.9; }
    .running-save-btn:active { transform: scale(0.98); }

    .running-stats {
      display: flex; gap: 16px; margin-bottom: 20px; flex-wrap: wrap;
    }
    .running-stat-card {
      flex: 1; min-width: 120px; background: #fff; border-radius: 16px; padding: 18px 14px;
      text-align: center; box-shadow: 0 4px 16px rgba(0,0,0,0.06); border-left: 4px solid #66bb6a;
    }
    .running-stat-card .rs-label { font-size: 12px; color: #888; margin-bottom: 6px; }
    .running-stat-card .rs-value { font-size: 22px; font-weight: bold; color: #388e3c; }
    .running-stat-card .rs-unit { font-size: 13px; color: #888; font-weight: normal; }

    /* ランニング月ナビ */
    .run-month-nav {
      display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 20px;
    }
    .run-month-nav button {
      background: #fff; border: 2px solid #c8e6c9; color: #388e3c; border-radius: 50%;
      width: 44px; height: 44px; font-size: 18px; cursor: pointer; font-weight: bold;
      display: flex; align-items: center; justify-content: center; transition: all 0.2s;
      -webkit-tap-highlight-color: transparent;
    }
    .run-month-nav button:hover { background: #e8f5e9; border-color: #66bb6a; }
    .run-month-nav .month-label { font-size: 18px; font-weight: bold; color: #388e3c; min-width: 140px; text-align: center; }

    .run-month-table {
      width: 100%; border-collapse: collapse; font-size: 14px;
    }
    .run-month-table th {
      background: #43a047; color: #fff; padding: 10px 8px; font-size: 12px; text-align: center;
    }
    .run-month-table td {
      padding: 8px 6px; text-align: center; border-bottom: 1px solid #e8f5e9;
    }
    .run-month-table tr.has-record { background: #f1f8e9; }
    .run-month-table tr.has-record:hover { background: #e8f5e9; }
    .run-month-table tr.no-record td { color: #ccc; }
    .run-month-table tr.today-row { background: #dcedc8; font-weight: bold; }
    .run-month-table tr.future-row td { color: #ddd; }
    .run-month-table .day-col { font-weight: bold; color: #388e3c; white-space: nowrap; }
    .run-month-table .sun { color: #e55; }
    .run-month-table .sat { color: #4a90d9; }
    .run-month-table .val-cell.has-val { color: #333; font-weight: bold; }
    .run-month-table .delete-cell button {
      background: none; border: 1px solid #ffb3b3; color: #e55; border-radius: 6px;
      padding: 2px 8px; font-size: 11px; cursor: pointer; transition: all 0.2s;
    }
    .run-month-table .delete-cell button:hover { background: #ffe5e5; }
    .run-month-table tfoot td {
      background: #e8f5e9; font-weight: bold; color: #388e3c;
      border-top: 2px solid #c8e6c9; padding: 10px 6px;
    }

    /* ========== トースト ========== */
    .toast {
      position: fixed; bottom: 30px; left: 50%;
      transform: translateX(-50%) translateY(80px);
      background: #333; color: #fff; padding: 14px 28px; border-radius: 14px;
      font-size: 15px; font-weight: bold; box-shadow: 0 6px 20px rgba(0,0,0,0.2);
      z-index: 100; opacity: 0; transition: all 0.3s ease; pointer-events: none;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    .empty-message { text-align: center; color: #aaa; font-size: 15px; padding: 40px 0; }

    footer {
      text-align: center; padding: 32px 20px; color: #aaa; font-size: 13px; background: #f0f7fe;
    }

    /* ========== レスポンシブ ========== */
    @media (max-width: 600px) {
      .hero h1 { font-size: 26px; }
      .exercise-cards { grid-template-columns: 1fr; }
      .stats-grid { grid-template-columns: 1fr; }
      .running-form-row { flex-direction: column; align-items: stretch; }
      .running-form-group { min-width: 0; }
      .running-stats { flex-direction: column; }
      .stat-card .stat-row { gap: 2px; }
      .stat-card .stat-value { font-size: 17px; }
    }
  </style>
</head>
<body>

  <!-- ===== ヘッダー ===== -->
  <section class="hero">
    <a href="index.html" class="back-link">&larr; 自己紹介へ</a>
    <h1>トレーニング記録</h1>
    <p class="tagline">今日もコツコツ鍛えよう！</p>
  </section>

  <!-- ===== 記録入力 ===== -->
  <section class="section">
    <h2 class="section-title">トレーニング記録<span>Daily Training</span></h2>

    <div class="workout-date-row">
      <label for="recordDate">日付:</label>
      <input type="date" id="recordDate">
    </div>

    <h3 style="font-size: 18px; color: #2a6cb6; text-align: center; margin-bottom: 16px;">筋トレ</h3>

    <div class="exercise-cards">
      <!-- クランチ -->
      <div class="exercise-card">
        <div class="card-illust">
          <svg width="70" height="50" viewBox="0 0 80 50" xmlns="http://www.w3.org/2000/svg">
            <line x1="5" y1="44" x2="75" y2="44" stroke="#d6ecfa" stroke-width="2"/>
            <line x1="12" y1="40" x2="24" y2="26" stroke="#4a90d9" stroke-width="3" stroke-linecap="round"/>
            <line x1="24" y1="26" x2="32" y2="40" stroke="#4a90d9" stroke-width="3" stroke-linecap="round"/>
            <line x1="32" y1="40" x2="44" y2="39" stroke="#4a90d9" stroke-width="3" stroke-linecap="round"/>
            <line x1="44" y1="39" x2="56" y2="22" stroke="#4a90d9" stroke-width="3" stroke-linecap="round"/>
            <circle cx="60" cy="17" r="5.5" fill="#4a90d9"/>
            <line x1="51" y1="26" x2="57" y2="16" stroke="#4a90d9" stroke-width="2.5" stroke-linecap="round"/>
            <line x1="57" y1="17" x2="65" y2="20" stroke="#4a90d9" stroke-width="2.5" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="card-name">クランチ</div>
        <div class="card-desc">腹筋を鍛える基本種目</div>
        <div class="reps-input-row">
          <input type="number" id="reps-crunch" min="0" step="10" placeholder="0">
          <span class="unit">回</span>
        </div>
      </div>

      <!-- バイシクルクランチ -->
      <div class="exercise-card">
        <div class="card-illust">
          <svg width="70" height="50" viewBox="0 0 80 50" xmlns="http://www.w3.org/2000/svg">
            <line x1="5" y1="44" x2="75" y2="44" stroke="#d6ecfa" stroke-width="2"/>
            <line x1="20" y1="40" x2="35" y2="24" stroke="#4a90d9" stroke-width="3" stroke-linecap="round"/>
            <line x1="35" y1="24" x2="38" y2="40" stroke="#4a90d9" stroke-width="3" stroke-linecap="round"/>
            <line x1="38" y1="38" x2="48" y2="38" stroke="#4a90d9" stroke-width="3" stroke-linecap="round"/>
            <line x1="48" y1="38" x2="56" y2="24" stroke="#4a90d9" stroke-width="3" stroke-linecap="round"/>
            <circle cx="60" cy="20" r="5.5" fill="#4a90d9"/>
            <line x1="52" y1="28" x2="38" y2="22" stroke="#5fb8f5" stroke-width="2.5" stroke-linecap="round"/>
            <path d="M54 28 Q50 18 42 24" stroke="#5fb8f5" stroke-width="2" fill="none" stroke-linecap="round" stroke-dasharray="3 2"/>
          </svg>
        </div>
        <div class="card-name">バイシクルクランチ</div>
        <div class="card-desc">左右にひねる腹筋</div>
        <div class="reps-input-row">
          <input type="number" id="reps-bicycle" min="0" step="10" placeholder="0">
          <span class="unit">回</span>
        </div>
      </div>

      <!-- プッシュアップ -->
      <div class="exercise-card">
        <div class="card-illust">
          <svg width="70" height="50" viewBox="0 0 80 50" xmlns="http://www.w3.org/2000/svg">
            <line x1="5" y1="44" x2="75" y2="44" stroke="#d6ecfa" stroke-width="2"/>
            <circle cx="18" cy="24" r="5.5" fill="#4a90d9"/>
            <line x1="23" y1="27" x2="55" y2="30" stroke="#4a90d9" stroke-width="3" stroke-linecap="round"/>
            <line x1="55" y1="30" x2="68" y2="40" stroke="#4a90d9" stroke-width="3" stroke-linecap="round"/>
            <line x1="26" y1="30" x2="22" y2="40" stroke="#4a90d9" stroke-width="3" stroke-linecap="round"/>
            <line x1="30" y1="30" x2="34" y2="40" stroke="#4a90d9" stroke-width="3" stroke-linecap="round"/>
            <line x1="22" y1="40" x2="22" y2="44" stroke="#4a90d9" stroke-width="2" stroke-linecap="round"/>
            <line x1="34" y1="40" x2="34" y2="44" stroke="#4a90d9" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="card-name">プッシュアップ</div>
        <div class="card-desc">腕立て伏せ</div>
        <div class="reps-input-row">
          <input type="number" id="reps-pushup" min="0" step="10" placeholder="0">
          <span class="unit">回</span>
        </div>
      </div>

      <!-- リバースプッシュアップ -->
      <div class="exercise-card">
        <div class="card-illust">
          <svg width="70" height="50" viewBox="0 0 80 50" xmlns="http://www.w3.org/2000/svg">
            <line x1="5" y1="44" x2="75" y2="44" stroke="#d6ecfa" stroke-width="2"/>
            <rect x="56" y="28" width="16" height="16" rx="3" fill="#d6ecfa" stroke="#b0d4f1" stroke-width="1.5"/>
            <circle cx="50" cy="20" r="5.5" fill="#4a90d9"/>
            <line x1="46" y1="24" x2="28" y2="30" stroke="#4a90d9" stroke-width="3" stroke-linecap="round"/>
            <line x1="28" y1="30" x2="12" y2="40" stroke="#4a90d9" stroke-width="3" stroke-linecap="round"/>
            <line x1="50" y1="26" x2="58" y2="30" stroke="#4a90d9" stroke-width="3" stroke-linecap="round"/>
            <line x1="54" y1="28" x2="62" y2="30" stroke="#4a90d9" stroke-width="3" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="card-name">リバースプッシュアップ</div>
        <div class="card-desc">仰向けで行う腕立て伏せ</div>
        <div class="reps-input-row">
          <input type="number" id="reps-reverse" min="0" step="10" placeholder="0">
          <span class="unit">回</span>
        </div>
      </div>
    </div>

    <button class="save-btn" onclick="saveWorkout()">記録する</button>

    <!-- ランニング入力（ここに配置） -->
    <div style="margin-top: 36px;">
      <h3 style="font-size: 20px; color: #388e3c; text-align: center; margin-bottom: 16px;">
        ランニング記録
        <span style="display:block; font-size:12px; color:#999; font-weight:normal; margin-top:3px; letter-spacing:2px; text-transform:uppercase;">Running Log</span>
      </h3>
      <div class="running-form-card">
        <div class="running-form-row">
          <div class="running-form-group">
            <label for="runDistance">距離 (km)</label>
            <input type="number" id="runDistance" min="0" step="1" placeholder="5">
          </div>
          <div class="running-form-group">
            <label for="runTime">タイム（任意）</label>
            <input type="text" id="runTime" placeholder="例: 25:30">
          </div>
          <button class="running-save-btn" onclick="saveRun()">記録する</button>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== 筋トレ統計 ===== -->
  <section class="section" style="padding-top: 0;">
    <h2 class="section-title">統計<span>Statistics</span></h2>
    <div class="stats-grid" id="statsGrid"></div>
  </section>

  <!-- ===== 筋トレ月別履歴 ===== -->
  <section class="section" style="padding-top: 0;">
    <h2 class="section-title">月別記録<span>Monthly Log</span></h2>
    <div class="month-nav">
      <button onclick="changeWorkoutMonth(-1)">&lt;</button>
      <div class="month-label" id="workoutMonthLabel"></div>
      <button onclick="changeWorkoutMonth(1)">&gt;</button>
    </div>
    <div class="month-summary" id="workoutMonthSummary"></div>
    <div class="month-table-wrap">
      <div id="workoutMonthTable"></div>
    </div>
  </section>

  <!-- ===== ランニング ===== -->
  <section class="running-section">
    <div class="running-inner">
      <h2 class="section-title">ランニング統計・履歴<span>Running Stats &amp; History</span></h2>

      <div class="running-stats" id="runningStats"></div>

      <div class="run-month-nav">
        <button onclick="changeRunMonth(-1)">&lt;</button>
        <div class="month-label" id="runMonthLabel"></div>
        <button onclick="changeRunMonth(1)">&gt;</button>
      </div>
      <div class="month-summary" id="runMonthSummary" style="color:#388e3c;"></div>
      <div class="month-table-wrap">
        <div id="runMonthTable"></div>
      </div>
    </div>
  </section>

  <div class="toast" id="toast"></div>
  <footer>&copy; 2026 田口 &#8212; Training Tracker</footer>

  <script>
    // ========== 定数 ==========
    var EXERCISES = [
      { key: 'crunch',  name: 'クランチ',           inputId: 'reps-crunch' },
      { key: 'bicycle', name: 'バイシクルクランチ',   inputId: 'reps-bicycle' },
      { key: 'pushup',  name: 'プッシュアップ',       inputId: 'reps-pushup' },
      { key: 'reverse', name: 'リバースプッシュアップ', inputId: 'reps-reverse' },
    ];
    var DAY_NAMES = ['日','月','火','水','木','金','土'];

    // 表示中の月 (0-indexed month)
    var wMonth = { year: new Date().getFullYear(), month: new Date().getMonth() };
    var rMonth = { year: new Date().getFullYear(), month: new Date().getMonth() };

    // ========== localStorage ==========
    function getWorkouts() {
      try { return JSON.parse(localStorage.getItem('workouts') || '[]'); } catch(e) { return []; }
    }
    function saveWorkouts(d) { localStorage.setItem('workouts', JSON.stringify(d)); }
    function getRuns() {
      try { return JSON.parse(localStorage.getItem('runs') || '[]'); } catch(e) { return []; }
    }
    function saveRuns(d) { localStorage.setItem('runs', JSON.stringify(d)); }

    // ========== 日付ヘルパー ==========
    function todayStr() {
      var t = new Date();
      return t.getFullYear() + '-' + pad(t.getMonth()+1) + '-' + pad(t.getDate());
    }
    function pad(n) { return n < 10 ? '0' + n : '' + n; }
    function daysInMonth(y, m) { return new Date(y, m + 1, 0).getDate(); }
    function dateStr(y, m, d) { return y + '-' + pad(m+1) + '-' + pad(d); }
    function monthLabel(y, m) { return y + '年' + (m + 1) + '月'; }

    // 直近N日の日付リストを返す（今日含む）
    function lastNDays(n) {
      var dates = [];
      var d = new Date();
      for (var i = 0; i < n; i++) {
        dates.push(d.getFullYear() + '-' + pad(d.getMonth()+1) + '-' + pad(d.getDate()));
        d.setDate(d.getDate() - 1);
      }
      return dates;
    }

    function escapeHTML(str) {
      var div = document.createElement('div');
      div.appendChild(document.createTextNode(str));
      return div.innerHTML;
    }

    function showToast(msg) {
      var t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(function() { t.classList.remove('show'); }, 2000);
    }

    // ========== 筋トレ: 保存 ==========
    function saveWorkout() {
      var date = document.getElementById('recordDate').value;
      if (!date) { showToast('日付を入力してください'); return; }

      var entry = { id: Date.now(), date: date };
      var hasAny = false;
      EXERCISES.forEach(function(ex) {
        var val = document.getElementById(ex.inputId).value;
        var num = val ? parseInt(val) : 0;
        entry[ex.key] = num;
        if (num > 0) hasAny = true;
      });
      if (!hasAny) { showToast('少なくとも1種目の回数を入力してください'); return; }

      var workouts = getWorkouts();
      workouts.push(entry);
      saveWorkouts(workouts);

      EXERCISES.forEach(function(ex) { document.getElementById(ex.inputId).value = ''; });
      renderAll();
      showToast('筋トレ記録を保存しました！');
    }

    function deleteWorkout(id) {
      saveWorkouts(getWorkouts().filter(function(w) { return w.id !== id; }));
      renderAll();
      showToast('削除しました');
    }

    // ========== 筋トレ: 日別合算マップを作る ==========
    function buildDailyWorkoutMap() {
      var map = {}; // { "2026-02-14": { crunch: 30, ... } }
      getWorkouts().forEach(function(w) {
        if (!map[w.date]) {
          map[w.date] = {};
          EXERCISES.forEach(function(ex) { map[w.date][ex.key] = 0; });
        }
        EXERCISES.forEach(function(ex) { map[w.date][ex.key] += (w[ex.key] || 0); });
      });
      return map;
    }

    // ========== 筋トレ: 統計 ==========
    function renderWorkoutStats() {
      var workouts = getWorkouts();
      var container = document.getElementById('statsGrid');
      if (workouts.length === 0) { container.innerHTML = ''; return; }

      var dailyMap = buildDailyWorkoutMap();

      // 今月の日数（今日まで）
      var today = new Date();
      var curY = today.getFullYear(), curM = today.getMonth();
      var daysThisMonth = today.getDate(); // 1日〜今日

      // 今月の日別合計
      var monthTotals = {};
      EXERCISES.forEach(function(ex) { monthTotals[ex.key] = 0; });
      for (var d = 1; d <= daysThisMonth; d++) {
        var ds = dateStr(curY, curM, d);
        if (dailyMap[ds]) {
          EXERCISES.forEach(function(ex) { monthTotals[ex.key] += dailyMap[ds][ex.key]; });
        }
      }

      // 累計
      var cumulative = {};
      EXERCISES.forEach(function(ex) { cumulative[ex.key] = 0; });
      workouts.forEach(function(w) {
        EXERCISES.forEach(function(ex) { cumulative[ex.key] += (w[ex.key] || 0); });
      });

      container.innerHTML = EXERCISES.map(function(ex) {
        var monthAvg = daysThisMonth > 0 ? Math.round(monthTotals[ex.key] / daysThisMonth * 10) / 10 : 0;

        return '<div class="stat-card">' +
          '<div class="stat-name">' + ex.name + '</div>' +
          '<div class="stat-row">' +
            '<div class="stat-item"><div class="stat-value">' + cumulative[ex.key] + '</div><div class="stat-label">累計</div></div>' +
            '<div class="stat-item"><div class="stat-value">' + monthAvg + '</div><div class="stat-label">今月平均/日</div></div>' +
          '</div>' +
        '</div>';
      }).join('');
    }

    // ========== 筋トレ: 月別テーブル ==========
    function changeWorkoutMonth(delta) {
      wMonth.month += delta;
      if (wMonth.month < 0) { wMonth.month = 11; wMonth.year--; }
      if (wMonth.month > 11) { wMonth.month = 0; wMonth.year++; }
      // 未来月には行かせない
      var now = new Date();
      if (wMonth.year > now.getFullYear() || (wMonth.year === now.getFullYear() && wMonth.month > now.getMonth())) {
        wMonth.year = now.getFullYear(); wMonth.month = now.getMonth();
      }
      renderWorkoutMonth();
    }

    function renderWorkoutMonth() {
      document.getElementById('workoutMonthLabel').textContent = monthLabel(wMonth.year, wMonth.month);

      var dailyMap = buildDailyWorkoutMap();
      var workouts = getWorkouts();
      var days = daysInMonth(wMonth.year, wMonth.month);
      var today = todayStr();
      var now = new Date();
      var isCurrentMonth = (wMonth.year === now.getFullYear() && wMonth.month === now.getMonth());
      var maxDay = isCurrentMonth ? now.getDate() : days;

      // 月サマリー
      var monthTotal = {};
      EXERCISES.forEach(function(ex) { monthTotal[ex.key] = 0; });
      for (var d = 1; d <= maxDay; d++) {
        var ds = dateStr(wMonth.year, wMonth.month, d);
        if (dailyMap[ds]) {
          EXERCISES.forEach(function(ex) { monthTotal[ex.key] += dailyMap[ds][ex.key]; });
        }
      }

      var summaryParts = EXERCISES.map(function(ex) {
        var avg = maxDay > 0 ? Math.round(monthTotal[ex.key] / maxDay * 10) / 10 : 0;
        return '<span><strong>' + ex.name + ':</strong> 計' + monthTotal[ex.key] + '回 (平均' + avg + '/日)</span>';
      });
      document.getElementById('workoutMonthSummary').innerHTML = summaryParts.join('');

      // テーブル構築
      // 日ごとに複数レコードがあり得るので、id一覧も保持
      var dayRecords = {}; // date -> [record, ...]
      workouts.forEach(function(w) {
        if (!dayRecords[w.date]) dayRecords[w.date] = [];
        dayRecords[w.date].push(w);
      });

      var html = '<table class="month-table"><thead><tr>' +
        '<th>日付</th>';
      EXERCISES.forEach(function(ex) { html += '<th>' + ex.name.replace('プッシュアップ','プッシュ\nアップ').replace('バイシクルクランチ','バイシクル\nクランチ').replace('リバースプッシュアップ','リバース\nプッシュアップ') + '</th>'; });
      // Actually let me use shorter names
      html = '<table class="month-table"><thead><tr>' +
        '<th>日付</th>' +
        '<th>クランチ</th><th>バイシクル</th><th>プッシュ<br>アップ</th><th>リバース</th><th></th>' +
        '</tr></thead><tbody>';

      for (var d = 1; d <= days; d++) {
        var ds = dateStr(wMonth.year, wMonth.month, d);
        var dt = new Date(wMonth.year, wMonth.month, d);
        var dow = dt.getDay();
        var isToday = ds === today;
        var isFuture = isCurrentMonth && d > now.getDate();
        var hasData = !!dailyMap[ds];

        var rowClass = '';
        if (isToday) rowClass = 'today-row';
        else if (isFuture) rowClass = 'future-row';
        else if (hasData) rowClass = 'has-record';
        else rowClass = 'no-record';

        var dayClass = 'day-col';
        if (dow === 0) dayClass += ' sun';
        else if (dow === 6) dayClass += ' sat';

        html += '<tr class="' + rowClass + '">';
        html += '<td class="' + dayClass + '">' + d + ' (' + DAY_NAMES[dow] + ')</td>';

        EXERCISES.forEach(function(ex) {
          var val = (dailyMap[ds] && dailyMap[ds][ex.key]) ? dailyMap[ds][ex.key] : 0;
          if (isFuture) {
            html += '<td class="val-cell">-</td>';
          } else {
            html += '<td class="val-cell' + (val > 0 ? ' has-val' : '') + '">' + val + '</td>';
          }
        });

        // 削除ボタン（レコードがある場合のみ）
        if (dayRecords[ds] && dayRecords[ds].length > 0 && !isFuture) {
          var ids = dayRecords[ds].map(function(r) { return r.id; });
          html += '<td class="delete-cell"><button onclick="deleteDayWorkouts([' + ids.join(',') + '])">削除</button></td>';
        } else {
          html += '<td></td>';
        }

        html += '</tr>';
      }

      // フッター: 合計行
      html += '</tbody><tfoot><tr><td>合計</td>';
      EXERCISES.forEach(function(ex) {
        html += '<td>' + monthTotal[ex.key] + '</td>';
      });
      html += '<td></td></tr>';

      // 平均行
      html += '<tr><td>平均/日</td>';
      EXERCISES.forEach(function(ex) {
        var avg = maxDay > 0 ? Math.round(monthTotal[ex.key] / maxDay * 10) / 10 : 0;
        html += '<td>' + avg + '</td>';
      });
      html += '<td></td></tr></tfoot></table>';

      document.getElementById('workoutMonthTable').innerHTML = html;
    }

    function deleteDayWorkouts(ids) {
      var workouts = getWorkouts().filter(function(w) { return ids.indexOf(w.id) === -1; });
      saveWorkouts(workouts);
      renderAll();
      showToast('削除しました');
    }

    // ========== ランニング: 保存 ==========
    function saveRun() {
      var date = document.getElementById('recordDate').value;
      var distance = document.getElementById('runDistance').value;
      var time = document.getElementById('runTime').value.trim();
      if (!date || !distance) { showToast('日付と距離は必須です'); return; }

      var runs = getRuns();
      runs.push({ id: Date.now(), date: date, distance: parseFloat(distance), time: time || null });
      saveRuns(runs);

      document.getElementById('runDistance').value = '';
      document.getElementById('runTime').value = '';
      renderAll();
      showToast('ランニング記録を保存しました！');
    }

    function deleteRun(id) {
      saveRuns(getRuns().filter(function(r) { return r.id !== id; }));
      renderAll();
      showToast('削除しました');
    }

    function deleteDayRuns(ids) {
      saveRuns(getRuns().filter(function(r) { return ids.indexOf(r.id) === -1; }));
      renderAll();
      showToast('削除しました');
    }

    // ========== ランニング: 日別マップ ==========
    function buildDailyRunMap() {
      var map = {}; // { "2026-02-14": { distance: 5.0, time: "25:30", ids: [...] } }
      getRuns().forEach(function(r) {
        if (!map[r.date]) map[r.date] = { distance: 0, times: [], ids: [] };
        map[r.date].distance += r.distance;
        if (r.time) map[r.date].times.push(r.time);
        map[r.date].ids.push(r.id);
      });
      return map;
    }

    // ========== ランニング: 統計 ==========
    function renderRunningStats() {
      var runs = getRuns();
      var container = document.getElementById('runningStats');
      if (runs.length === 0) { container.innerHTML = ''; return; }

      var dailyMap = buildDailyRunMap();
      var today = new Date();
      var curY = today.getFullYear(), curM = today.getMonth();
      var daysThisMonth = today.getDate();

      // 累計
      var totalDist = 0;
      runs.forEach(function(r) { totalDist += r.distance; });
      totalDist = Math.round(totalDist * 100) / 100;

      // 今月平均/日（記録ない日は0km）
      var monthDist = 0;
      for (var d = 1; d <= daysThisMonth; d++) {
        var ds = dateStr(curY, curM, d);
        if (dailyMap[ds]) monthDist += dailyMap[ds].distance;
      }
      var monthAvg = daysThisMonth > 0 ? Math.round(monthDist / daysThisMonth * 10) / 10 : 0;

      container.innerHTML =
        '<div class="running-stat-card"><div class="rs-label">累計距離</div><div class="rs-value">' + totalDist + ' <span class="rs-unit">km</span></div></div>' +
        '<div class="running-stat-card"><div class="rs-label">今月平均/日</div><div class="rs-value">' + monthAvg + ' <span class="rs-unit">km</span></div></div>';
    }

    // ========== ランニング: 月別テーブル ==========
    function changeRunMonth(delta) {
      rMonth.month += delta;
      if (rMonth.month < 0) { rMonth.month = 11; rMonth.year--; }
      if (rMonth.month > 11) { rMonth.month = 0; rMonth.year++; }
      var now = new Date();
      if (rMonth.year > now.getFullYear() || (rMonth.year === now.getFullYear() && rMonth.month > now.getMonth())) {
        rMonth.year = now.getFullYear(); rMonth.month = now.getMonth();
      }
      renderRunMonth();
    }

    function renderRunMonth() {
      document.getElementById('runMonthLabel').textContent = monthLabel(rMonth.year, rMonth.month);

      var dailyMap = buildDailyRunMap();
      var days = daysInMonth(rMonth.year, rMonth.month);
      var today = todayStr();
      var now = new Date();
      var isCurrentMonth = (rMonth.year === now.getFullYear() && rMonth.month === now.getMonth());
      var maxDay = isCurrentMonth ? now.getDate() : days;

      // 月サマリー
      var monthDist = 0;
      var runDays = 0;
      for (var d = 1; d <= maxDay; d++) {
        var ds = dateStr(rMonth.year, rMonth.month, d);
        if (dailyMap[ds]) { monthDist += dailyMap[ds].distance; runDays++; }
      }
      monthDist = Math.round(monthDist * 100) / 100;
      var avg = maxDay > 0 ? Math.round(monthDist / maxDay * 10) / 10 : 0;
      document.getElementById('runMonthSummary').innerHTML =
        '<span><strong>合計:</strong> ' + monthDist + 'km</span>' +
        '<span><strong>走った日数:</strong> ' + runDays + '日</span>' +
        '<span><strong>平均/日:</strong> ' + avg + 'km</span>';

      // テーブル
      var html = '<table class="run-month-table"><thead><tr>' +
        '<th>日付</th><th>距離</th><th>タイム</th><th></th>' +
        '</tr></thead><tbody>';

      for (var d = 1; d <= days; d++) {
        var ds = dateStr(rMonth.year, rMonth.month, d);
        var dt = new Date(rMonth.year, rMonth.month, d);
        var dow = dt.getDay();
        var isToday = ds === today;
        var isFuture = isCurrentMonth && d > now.getDate();
        var hasData = !!dailyMap[ds];

        var rowClass = '';
        if (isToday) rowClass = 'today-row';
        else if (isFuture) rowClass = 'future-row';
        else if (hasData) rowClass = 'has-record';
        else rowClass = 'no-record';

        var dayClass = 'day-col';
        if (dow === 0) dayClass += ' sun';
        else if (dow === 6) dayClass += ' sat';

        html += '<tr class="' + rowClass + '">';
        html += '<td class="' + dayClass + '">' + d + ' (' + DAY_NAMES[dow] + ')</td>';

        if (isFuture) {
          html += '<td class="val-cell">-</td><td>-</td><td></td>';
        } else if (hasData) {
          var dist = Math.round(dailyMap[ds].distance * 100) / 100;
          var times = dailyMap[ds].times.length > 0 ? escapeHTML(dailyMap[ds].times.join(', ')) : '-';
          html += '<td class="val-cell has-val">' + dist + ' km</td>';
          html += '<td>' + times + '</td>';
          html += '<td class="delete-cell"><button onclick="deleteDayRuns([' + dailyMap[ds].ids.join(',') + '])">削除</button></td>';
        } else {
          html += '<td class="val-cell">0</td><td>-</td><td></td>';
        }

        html += '</tr>';
      }

      html += '</tbody><tfoot><tr>';
      html += '<td>合計</td><td>' + monthDist + ' km</td><td></td><td></td>';
      html += '</tr><tr>';
      html += '<td>平均/日</td><td>' + avg + ' km</td><td></td><td></td>';
      html += '</tr></tfoot></table>';

      document.getElementById('runMonthTable').innerHTML = html;
    }

    // ========== 全描画 ==========
    function renderAll() {
      renderWorkoutStats();
      renderWorkoutMonth();
      renderRunningStats();
      renderRunMonth();
    }

    // ========== 初期化 ==========
    (function init() {
      document.getElementById('recordDate').value = todayStr();
      renderAll();
    })();
  </script>

</body>
</html>
